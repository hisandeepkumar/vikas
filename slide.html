<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>PDF to Image Converter (Fast, Free & Secure)</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Noto+Sans+Devanagari:wght@400;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.worker.min.js"></script>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'Inter', 'Noto Sans Devanagari', -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, "Noto Color Emoji", "Apple Color Emoji", "Segoe UI Emoji", sans-serif;
      min-height: 100vh; display:flex; justify-content:center; align-items:center; padding:24px;
      color:#f0f0f0;
      background: linear-gradient(rgba(0,0,0,0.4),rgba(0,0,0,0.4)), url('images/background.jpg');
      background-size:cover; background-position:center; background-attachment:fixed;
    }
    .container {
      width:100%; max-width:900px; background: rgba(255,255,255,0.15); backdrop-filter: blur(16px);
      border-radius:20px; box-shadow:0 8px 32px rgba(0,0,0,0.2); overflow:hidden; border:1px solid rgba(255,255,255,0.3);
      transition: transform .3s; padding:24px;
    }
    .header { padding:18px; text-align:center; background: rgba(255,255,255,0.03); border-bottom:1px solid rgba(255,255,255,0.3); margin-bottom:18px; border-radius:12px; }
    .header h1 { font-size:26px; font-weight:600; color:#f0f0f0; display:flex; gap:12px; align-items:center; justify-content:center; }
    
    /* Upload Area Styles */
    .upload-area {
      border: 2px dashed rgba(255, 255, 255, 0.4);
      border-radius: 12px;
      padding: 24px 20px;
      text-align: center;
      background: rgba(255, 255, 255, 0.2);
      cursor: pointer;
      transition: all 0.3s ease;
      position: relative;
      box-shadow: 0 4px 16px rgba(0, 0, 0, 0.2),
                  inset 0 1px 2px rgba(255, 255, 255, 0.3);
      margin-bottom: 18px;
    }
    .upload-area:hover,
    .upload-area.active {
      background: rgba(255, 255, 255, 0.25);
      border-color: #5b86e5;
      box-shadow: 0 8px 24px rgba(91, 134, 229, 0.3),
                  inset 0 2px 4px rgba(255, 255, 255, 0.3);
    }
    .upload-area i {
      font-size: 40px;
      color: #5b86e5;
      margin-bottom: 15px;
      transition: all 0.3s;
    }
    .upload-area:hover i,
    .upload-area.active i {
      transform: scale(1.1);
    }
    .upload-area h3 {
      color: #f0f0f0;
      margin-bottom: 10px;
      font-size: 1.6rem;
      font-weight: 500;
    }
    .upload-area p {
      color: rgba(255, 255, 255, 0.8);
      font-size: 1.1rem;
    }
    .upload-area input[type="file"] {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      opacity: 0;
      cursor: pointer;
    }
    .file-info {
      color: white;
      font-size: 1rem;
      margin: 10px 0;
      text-align: center;
      word-break: break-all;
      padding: 0 10px;
      display: none;
      font-weight: bold;
      text-decoration: underline;
      background: linear-gradient(90deg,
                  rgba(255, 255, 255, 0) 0%,
                  rgba(255, 255, 255, 0.8) 50%,
                  rgba(255, 255, 255, 0) 100%);
      background-size: 200% 100%;
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      animation: shine 2s linear infinite;
    }
    @keyframes shine {
      from {
        background-position: 200% 0;
      }
      to {
        background-position: -200% 0;
      }
    }
    .size-info {
      color: rgba(255, 255, 255, 0.8);
      font-size: 0.9rem;
      margin: 10px 0;
      text-align: center;
      display: none;
      background: rgba(0, 0, 0, 0.3);
      padding: 8px 16px;
      border-radius: 8px;
      border: 1px solid rgba(255,255,255,0.2);
    }
    
    /* Custom Filename Input */
    .filename-input {
      margin: 20px 0;
      text-align: center;
    }
    .filename-input label {
      display: block;
      color: #f0f0f0;
      margin-bottom: 10px;
      font-size: 1.05rem;
      font-weight: 500;
    }
    .filename-input input {
      width: 100%;
      max-width: 400px;
      padding: 12px 16px;
      border-radius: 8px;
      background: rgba(255, 255, 255, 0.08);
      border: 1px solid rgba(255, 255, 255, 0.2);
      color: #f0f0f0;
      font-size: 1rem;
      font-family: inherit;
      text-align: center;
    }
    .filename-input input:focus {
      outline: none;
      border-color: #5b86e5;
      box-shadow: 0 0 0 4px rgba(91, 134, 229, 0.08);
    }
    .filename-input .hint {
      color: rgba(255, 255, 255, 0.7);
      font-size: 0.9rem;
      margin-top: 8px;
      font-style: italic;
    }
    
    /* PDF Info */
    .pdf-info {
      background: rgba(0, 0, 0, 0.3);
      border-radius: 12px;
      padding: 16px;
      margin: 20px 0;
      display: none;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }
    .pdf-info h3 {
      color: #f0f0f0;
      margin-bottom: 12px;
      font-size: 1.2rem;
      font-weight: 500;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .pdf-details {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 12px;
    }
    .pdf-detail {
      background: rgba(255, 255, 255, 0.05);
      padding: 12px;
      border-radius: 8px;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }
    .pdf-detail label {
      display: block;
      color: rgba(255, 255, 255, 0.7);
      font-size: 0.9rem;
      margin-bottom: 5px;
    }
    .pdf-detail span {
      color: #f0f0f0;
      font-weight: 500;
      font-size: 1rem;
    }
    
    /* Overlays Container */
    .overlays-container { 
      display: flex; 
      justify-content: space-around; 
      flex-wrap: wrap; 
      margin: 20px 0; 
      gap: 20px; 
    }
    .overlay-preview { 
      display: flex; 
      flex-direction: column; 
      align-items: center; 
      text-align: center; 
      background: rgba(255,255,255,0.03); 
      padding: 12px; 
      border-radius: 12px; 
      width: 200px; 
    }
    .overlay-preview h3 {
      color: #f0f0f0;
      font-size: 1rem;
      margin-bottom: 10px;
      font-weight: 500;
    }
    
    /* Page Preview */
    .page-preview {
      margin: 20px 0;
      text-align: center;
      display: none;
    }
    .page-preview h3 {
      color: #f0f0f0;
      margin-bottom: 15px;
      font-size: 1.2rem;
      font-weight: 500;
    }
    .preview-controls {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 15px;
      margin-bottom: 15px;
    }
    .preview-controls button {
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.2);
      color: #f0f0f0;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.3s ease;
      font-size: 18px;
    }
    .preview-controls button:hover {
      background: rgba(255, 255, 255, 0.15);
      transform: scale(1.1);
    }
    .preview-controls button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }
    .page-number {
      color: #f0f0f0;
      font-weight: 500;
      min-width: 100px;
      text-align: center;
    }
    .preview-canvas {
      max-width: 100%;
      max-height: 400px;
      border-radius: 8px;
      box-shadow: 0 4px 16px rgba(0, 0, 0, 0.3);
      border: 2px solid rgba(255, 255, 255, 0.1);
    }
    
    /* Progress Container */
    .progress-container { 
      width:100%; 
      height:8px; 
      background: rgba(255,255,255,0.05); 
      border-radius:4px; 
      overflow:hidden; 
      margin-top:12px; 
      display:none; 
    }
    .progress-bar { 
      width:0; 
      height:100%; 
      background: linear-gradient(90deg,#5b86e5,#36d1dc); 
      transition: width 0.3s ease; 
    }
    
    /* Download Button */
    .btn { 
      background: rgba(255,255,255,0.12); 
      backdrop-filter: blur(8px); 
      color:#f0f0f0; 
      border:1px solid rgba(255,255,255,0.14); 
      padding:12px 28px; 
      border-radius:28px; 
      width:260px; 
      height:54px; 
      font-size:15px; 
      font-weight:500; 
      cursor:pointer; 
      display:flex; 
      align-items:center; 
      justify-content:center; 
      gap:10px; 
      margin:18px auto 0; 
    }
    .btn:disabled { 
      opacity:0.5; 
      cursor:not-allowed; 
    }
    
    /* Footer */
    .footer { 
      margin-top:18px; 
      text-align:center; 
      color:rgba(255,255,255,0.7); 
      font-size:14px; 
      padding:12px; 
      border-top:1px solid rgba(255,255,255,0.06); 
    }
    
    /* Status Messages */
    .status-message {
      margin: 10px 0;
      padding: 12px;
      border-radius: 8px;
      text-align: center;
      font-size: 0.9rem;
      display: none;
    }
    .status-message.success {
      background: rgba(46, 125, 50, 0.3);
      border: 1px solid rgba(46, 125, 50, 0.5);
      color: #a5d6a7;
    }
    .status-message.error {
      background: rgba(211, 47, 47, 0.3);
      border: 1px solid rgba(211, 47, 47, 0.5);
      color: #ef9a9a;
    }
    .status-message.info {
      background: rgba(30, 136, 229, 0.3);
      border: 1px solid rgba(30, 136, 229, 0.5);
      color: #90caf9;
    }
    
    @media (max-width:768px) { 
      .container { padding:16px; } 
      .header h1 { font-size:22px; } 
      .btn { width:220px; height:50px; font-size:14px; } 
      .overlay-preview { width: 100%; max-width: 200px; }
      .pdf-details { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1><i class="fas fa-file-pdf"></i> PDF to Image Converter</h1>
      <p style="color: rgba(255,255,255,0.8); margin-top: 10px; font-size: 1rem;">
        Convert PDF pages to high-quality 4K images with logos and watermark
      </p>
    </div>

    <!-- Upload Area -->
    <div class="upload-area" id="uploadArea">
      <i class="fas fa-file-upload"></i>
      <h3>Upload PDF File</h3>
      <p>Click here or drag and drop your PDF file</p>
      <input type="file" id="pdfUpload" accept=".pdf">
    </div>
    
    <!-- File Info Display -->
    <p class="file-info" id="fileInfo"></p>
    <div class="size-info" id="sizeInfo"></div>

    <!-- Custom Filename Input -->
    <div class="filename-input">
      <label for="customFilename">Custom Filename (optional):</label>
      <input type="text" id="customFilename" placeholder="Leave empty to use PDF filename">
      <div class="hint">Leave empty to use existing filename. Images will be named as: [filename]-page1.png, [filename]-page2.png, etc.</div>
    </div>

    <!-- PDF Info -->
    <div class="pdf-info" id="pdfInfo">
      <h3><i class="fas fa-info-circle"></i> PDF Information</h3>
      <div class="pdf-details">
        <div class="pdf-detail">
          <label>Filename:</label>
          <span id="pdfFilename">-</span>
        </div>
        <div class="pdf-detail">
          <label>Pages:</label>
          <span id="pdfPages">-</span>
        </div>
        <div class="pdf-detail">
          <label>File Size:</label>
          <span id="pdfSize">-</span>
        </div>
      </div>
    </div>

    <!-- Page Preview -->
    <div class="page-preview" id="pagePreview">
      <h3>Page Preview</h3>
      <div class="preview-controls">
        <button id="prevPage" disabled><i class="fas fa-chevron-left"></i></button>
        <div class="page-number">Page <span id="currentPage">1</span> of <span id="totalPages">1</span></div>
        <button id="nextPage" disabled><i class="fas fa-chevron-right"></i></button>
      </div>
      <canvas id="previewCanvas" class="preview-canvas"></canvas>
    </div>

    <!-- Overlays Container -->
    <div class="overlays-container" id="overlaysContainer">
      <div class="overlay-preview logo-preview">
        <h3>Vikas Jajim Logo (Top Right)</h3>
        <img id="uiLogo" src="vikas_jajim_logo.png" alt="Logo" style="width:120px;height:60px;object-fit:contain;background:rgba(255,255,255,0.1);padding:5px;border-radius:8px;">
        <span>Logo will be added to the top right corner</span>
      </div>

      <div class="overlay-preview watermark-preview">
        <h3>Vikas Jajim Watermark (Center)</h3>
        <img id="uiWatermark" src="vikas_jajim_watermark.png" alt="Watermark" style="width:120px;height:60px;object-fit:contain;background:rgba(255,255,255,0.1);padding:5px;border-radius:8px;">
        <span>Watermark will be added to the center with low opacity</span>
      </div>

      <div class="overlay-preview notebook-preview">
        <h3>Notebook Hide Image (Bottom Right)</h3>
        <img id="uiNotebook" src="notebookhideimage.png" alt="Notebook Hide" style="width:120px;height:60px;object-fit:contain;background:rgba(255,255,255,0.1);padding:5px;border-radius:8px;">
        <span>Image will be added to the bottom right corner</span>
      </div>
    </div>

    <!-- Status Message -->
    <div class="status-message" id="statusMessage"></div>

    <div class="progress-container" id="progressContainer">
      <div class="progress-bar" id="progressBar"></div>
    </div>

    <button class="btn" id="downloadBtn" disabled>
      <i class="fas fa-download"></i>
      <span>Generate & Download ZIP</span>
    </button>

    <div class="footer">
      <div class="footer-text">Secure • Free • Professional | Made with <span style="color:#ff4d4d;">❤️</span> by <a href="https://www.instagram.com/sandeep_yadav_._._" target="_blank" style="color:#5b86e5; text-decoration:none;">Sandeep</a></div>
    </div>
  </div>

  <!-- Back Button -->
  <button type="button" title="Back" aria-label="Go back" onclick="(function(){ if(window.history.length>1){ history.back(); } else if(document.referrer){ location.href = document.referrer; } else { location.href = '/'; } })();" style="position: fixed; top: 14px; left: 14px; z-index: 2147483647; width: 52px; height: 52px; padding: 0; border-radius: 50%; border: none; background: linear-gradient(180deg, #ffffff, #f2f2f2); box-shadow: 0 4px 12px rgba(0,0,0,0.18); display: flex; align-items: center; justify-content: center; cursor: pointer; transition: transform .12s ease, box-shadow .12s ease; backdrop-filter: blur(6px); opacity: 0.98;">
    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true" focusable="false"><path d="M15 18l-6-6 6-6" stroke="#111" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round"></path></svg>
  </button>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      // DOM Element References
      const uploadArea = document.getElementById('uploadArea');
      const pdfInput = document.getElementById('pdfUpload');
      const fileInfoDisplay = document.getElementById('fileInfo');
      const sizeInfoDisplay = document.getElementById('sizeInfo');
      const downloadBtn = document.getElementById('downloadBtn');
      const progressContainer = document.getElementById('progressContainer');
      const progressBar = document.getElementById('progressBar');
      const statusMessage = document.getElementById('statusMessage');
      const pdfInfo = document.getElementById('pdfInfo');
      const pdfFilename = document.getElementById('pdfFilename');
      const pdfPages = document.getElementById('pdfPages');
      const pdfSize = document.getElementById('pdfSize');
      const customFilename = document.getElementById('customFilename');
      const pagePreview = document.getElementById('pagePreview');
      const previewCanvas = document.getElementById('previewCanvas');
      const previewCtx = previewCanvas.getContext('2d');
      const currentPageSpan = document.getElementById('currentPage');
      const totalPagesSpan = document.getElementById('totalPages');
      const prevPageBtn = document.getElementById('prevPage');
      const nextPageBtn = document.getElementById('nextPage');
      const uiLogoImg = document.getElementById('uiLogo');
      const uiWatermarkImg = document.getElementById('uiWatermark');
      const uiNotebookImg = document.getElementById('uiNotebook');

      // Application State
      let pdfDoc = null;
      let currentPageNum = 1;
      let totalPages = 0;
      let pdfFileName = '';
      let pdfFileSize = 0;
      let logoImage = null;
      let watermarkImage = null;
      let notebookImage = null;
      let imagesLoaded = false;

      // Load overlay images
      function loadOverlayImages() {
        return new Promise((resolve, reject) => {
          let loadedCount = 0;
          const totalImages = 3;

          const onImageLoad = () => {
            loadedCount++;
            if (loadedCount === totalImages) {
              imagesLoaded = true;
              resolve();
            }
          };

          const onImageError = (imgName) => {
            console.warn(`${imgName} not found, using fallback`);
            loadedCount++;
            if (loadedCount === totalImages) {
              imagesLoaded = true;
              resolve();
            }
          };

          // Load logo
          logoImage = new Image();
          logoImage.crossOrigin = 'anonymous';
          logoImage.onload = onImageLoad;
          logoImage.onerror = () => onImageError('Logo');
          logoImage.src = 'vikas_jajim_logo.png';

          // Load watermark
          watermarkImage = new Image();
          watermarkImage.crossOrigin = 'anonymous';
          watermarkImage.onload = onImageLoad;
          watermarkImage.onerror = () => onImageError('Watermark');
          watermarkImage.src = 'vikas_jajim_watermark.png';

          // Load notebook image
          notebookImage = new Image();
          notebookImage.crossOrigin = 'anonymous';
          notebookImage.onload = onImageLoad;
          notebookImage.onerror = () => onImageError('Notebook Hide');
          notebookImage.src = 'notebookhideimage.png';
        });
      }

      // Format file size to human readable format
      function formatFileSize(bytes) {
        if (bytes < 1024) return bytes + ' B';
        else if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(2) + ' KB';
        else return (bytes / (1024 * 1024)).toFixed(2) + ' MB';
      }

      // Show status message
      function showStatus(message, type = 'info') {
        statusMessage.textContent = message;
        statusMessage.className = `status-message ${type}`;
        statusMessage.style.display = 'block';
        
        if (type !== 'error') {
          setTimeout(() => {
            statusMessage.style.display = 'none';
          }, 5000);
        }
      }

      // Update progress bar
      function updateProgress(percent) {
        progressContainer.style.display = 'block';
        progressBar.style.width = `${percent}%`;
      }

      // Drag and Drop Event Handlers
      ['dragenter', 'dragover'].forEach(ev => {
        uploadArea.addEventListener(ev, e => {
          e.preventDefault();
          uploadArea.classList.add('active');
        });
      });

      ['dragleave', 'drop'].forEach(ev => {
        uploadArea.addEventListener(ev, e => {
          e.preventDefault();
          uploadArea.classList.remove('active');
        });
      });

      // Handle File Drop
      uploadArea.addEventListener('drop', (e) => {
        if (e.dataTransfer && e.dataTransfer.files && e.dataTransfer.files.length) {
          const file = e.dataTransfer.files[0];
          if (file.type === 'application/pdf' || file.name.toLowerCase().endsWith('.pdf')) {
            handlePDFSelection(file);
          } else {
            showStatus('Please select a PDF file', 'error');
          }
        }
      });

      // Handle File Selection
      pdfInput.addEventListener('change', (e) => {
        if (e.target.files && e.target.files.length) {
          const file = e.target.files[0];
          if (file.type === 'application/pdf' || file.name.toLowerCase().endsWith('.pdf')) {
            handlePDFSelection(file);
          } else {
            showStatus('Please select a PDF file', 'error');
          }
        }
      });

      // Handle PDF Selection
      async function handlePDFSelection(file) {
        try {
          // Update UI
          pdfFileName = file.name.replace(/\.[^/.]+$/, "");
          pdfFileSize = file.size;
          
          fileInfoDisplay.textContent = `${file.name}`;
          fileInfoDisplay.style.display = 'block';
          sizeInfoDisplay.textContent = `File Size: ${formatFileSize(file.size)}`;
          sizeInfoDisplay.style.display = 'block';

          // Load overlay images if not already loaded
          if (!imagesLoaded) {
            await loadOverlayImages();
          }

          // Load PDF document
          const arrayBuffer = await file.arrayBuffer();
          const loadingTask = pdfjsLib.getDocument({ data: arrayBuffer });
          
          pdfDoc = await loadingTask.promise;
          totalPages = pdfDoc.numPages;
          
          // Update PDF info
          pdfFilename.textContent = file.name;
          pdfPages.textContent = totalPages;
          pdfSize.textContent = formatFileSize(file.size);
          pdfInfo.style.display = 'block';
          
          // Update custom filename placeholder
          customFilename.placeholder = `Leave empty to use: ${pdfFileName}`;
          
          // Enable download button
          downloadBtn.disabled = false;
          
          // Show page preview
          pagePreview.style.display = 'block';
          totalPagesSpan.textContent = totalPages;
          
          // Load and render first page
          await renderPage(1);
          
          showStatus('PDF loaded successfully! You can now generate images.', 'success');
          
        } catch (error) {
          console.error('Error loading PDF:', error);
          showStatus('Error loading PDF file. Please try again.', 'error');
          resetUI();
        }
      }

      // Render PDF page to canvas
      async function renderPage(pageNumber) {
        try {
          const page = await pdfDoc.getPage(pageNumber);
          const viewport = page.getViewport({ scale: 1.5 }); // Reduced scale for preview
          
          // Set canvas dimensions
          previewCanvas.width = viewport.width;
          previewCanvas.height = viewport.height;
          
          // Clear canvas
          previewCtx.clearRect(0, 0, previewCanvas.width, previewCanvas.height);
          
          // Render PDF page
          const renderContext = {
            canvasContext: previewCtx,
            viewport: viewport
          };
          
          await page.render(renderContext).promise;
          
          // Update current page display
          currentPageNum = pageNumber;
          currentPageSpan.textContent = pageNumber;
          
          // Update navigation buttons
          prevPageBtn.disabled = pageNumber <= 1;
          nextPageBtn.disabled = pageNumber >= totalPages;
          
        } catch (error) {
          console.error('Error rendering page:', error);
          showStatus('Error rendering page preview', 'error');
        }
      }

      // Page navigation
      prevPageBtn.addEventListener('click', () => {
        if (currentPageNum > 1) {
          renderPage(currentPageNum - 1);
        }
      });

      nextPageBtn.addEventListener('click', () => {
        if (currentPageNum < totalPages) {
          renderPage(currentPageNum + 1);
        }
      });

      // Generate images from all PDF pages
      async function generateImagesFromPDF() {
        if (!pdfDoc) {
          showStatus('No PDF loaded', 'error');
          return null;
        }

        const images = [];
        updateProgress(0);

        try {
          for (let pageNum = 1; pageNum <= totalPages; pageNum++) {
            try {
              // Update progress
              updateProgress((pageNum / totalPages) * 100);
              
              // Get page
              const page = await pdfDoc.getPage(pageNum);
              
              // Calculate scale for 4K resolution (3840 pixels width)
              const viewport = page.getViewport({ scale: 1.0 });
              const targetWidth = 3840; // 4K width
              const targetHeight = Math.floor(viewport.height * (targetWidth / viewport.width));
              const scale = targetWidth / viewport.width;
              
              // Create canvas for this page
              const canvas = document.createElement('canvas');
              canvas.width = targetWidth;
              canvas.height = targetHeight;
              
              const ctx = canvas.getContext('2d');
              
              // Set white background
              ctx.fillStyle = 'white';
              ctx.fillRect(0, 0, canvas.width, canvas.height);
              
              // Create scaled viewport
              const scaledViewport = page.getViewport({ scale: scale });
              
              // Render PDF page to canvas
              const renderContext = {
                canvasContext: ctx,
                viewport: scaledViewport
              };
              
              await page.render(renderContext).promise;
              
              // Add overlays
              addOverlaysToCanvas(ctx, canvas);
              
              // Convert canvas to blob
              const blob = await new Promise((resolve, reject) => {
                canvas.toBlob((blob) => {
                  if (blob) {
                    resolve(blob);
                  } else {
                    reject(new Error('Canvas to blob conversion failed'));
                  }
                }, 'image/png', 1.0);
              });
              
              images.push({
                pageNum: pageNum,
                blob: blob,
                width: canvas.width,
                height: canvas.height
              });
              
            } catch (pageError) {
              console.error(`Error generating image for page ${pageNum}:`, pageError);
              // Continue with next page
              continue;
            }
          }
          
          if (images.length === 0) {
            showStatus('No images were generated from the PDF', 'error');
            return null;
          }
          
          updateProgress(100);
          return images;
          
        } catch (error) {
          console.error('Error generating images:', error);
          showStatus('Error generating images', 'error');
          return null;
        }
      }

      // Add overlays to canvas
      function addOverlaysToCanvas(ctx, canvas) {
        // Add logo (top right)
        if (logoImage && logoImage.complete) {
          const logoWidth = canvas.width * 0.15; // 15% of canvas width
          const logoHeight = (logoImage.height * logoWidth) / logoImage.width;
          const logoX = canvas.width - logoWidth - (canvas.width * 0.02); // 2% margin
          const logoY = canvas.height * 0.02; // 2% margin
          
          ctx.globalAlpha = 0.9;
          ctx.drawImage(logoImage, logoX, logoY, logoWidth, logoHeight);
        }
        
        // Add watermark (center)
        if (watermarkImage && watermarkImage.complete) {
          const wmWidth = canvas.width * 0.25; // 25% of canvas width
          const wmHeight = (watermarkImage.height * wmWidth) / watermarkImage.width;
          const wmX = (canvas.width - wmWidth) / 2;
          const wmY = (canvas.height - wmHeight) / 2;
          
          ctx.globalAlpha = 0.28; // 28% opacity
          ctx.drawImage(watermarkImage, wmX, wmY, wmWidth, wmHeight);
        }
        
        // Add notebook image (bottom right)
        if (notebookImage && notebookImage.complete) {
          const nbWidth = canvas.width * 0.1; // 10% of canvas width
          const nbHeight = (notebookImage.height * nbWidth) / notebookImage.width;
          const nbX = canvas.width - nbWidth - (canvas.width * 0.02); // 2% margin
          const nbY = canvas.height - nbHeight - (canvas.height * 0.02); // 2% margin
          
          ctx.globalAlpha = 0.9;
          ctx.drawImage(notebookImage, nbX, nbY, nbWidth, nbHeight);
        }
        
        // Reset global alpha
        ctx.globalAlpha = 1.0;
      }

      // Generate and download ZIP
      async function generateAndDownloadZIP() {
        if (!pdfDoc) {
          showStatus('Please upload a PDF first', 'error');
          return;
        }

        downloadBtn.disabled = true;
        showStatus('Generating images... This may take a moment.', 'info');

        try {
          // Generate images from PDF
          const images = await generateImagesFromPDF();
          
          if (!images || images.length === 0) {
            showStatus('No images were generated. Please try again.', 'error');
            downloadBtn.disabled = false;
            progressContainer.style.display = 'none';
            return;
          }

          // Determine filename
          let baseFilename = customFilename.value.trim();
          if (!baseFilename) {
            baseFilename = pdfFileName;
          }

          // Create ZIP file
          const zip = new JSZip();
          
          // Add each image to ZIP
          images.forEach((image, index) => {
            const filename = `${baseFilename}-page${index + 1}.png`;
            zip.file(filename, image.blob);
          });

          // Generate ZIP file
          const zipBlob = await zip.generateAsync({ type: 'blob' });
          
          // Download ZIP
          const zipFilename = `${baseFilename}-converted.zip`;
          saveAs(zipBlob, zipFilename);
          
          showStatus(`Successfully generated ${images.length} images in ${zipFilename}`, 'success');
          
          // Reset progress
          setTimeout(() => {
            progressContainer.style.display = 'none';
            progressBar.style.width = '0%';
            downloadBtn.disabled = false;
          }, 2000);
          
        } catch (error) {
          console.error('Error generating ZIP:', error);
          showStatus('Error generating ZIP file: ' + error.message, 'error');
          downloadBtn.disabled = false;
          progressContainer.style.display = 'none';
          progressBar.style.width = '0%';
        }
      }

      // Reset UI
      function resetUI() {
        fileInfoDisplay.style.display = 'none';
        sizeInfoDisplay.style.display = 'none';
        pdfInfo.style.display = 'none';
        pagePreview.style.display = 'none';
        downloadBtn.disabled = true;
        pdfDoc = null;
        currentPageNum = 1;
        totalPages = 0;
        pdfFileName = '';
        pdfFileSize = 0;
        customFilename.value = '';
        customFilename.placeholder = 'Leave empty to use PDF filename';
      }

      // Download button click event
      downloadBtn.addEventListener('click', generateAndDownloadZIP);

      // Load overlay images on startup
      loadOverlayImages().then(() => {
        console.log('All overlay images loaded');
      }).catch(error => {
        console.warn('Some overlay images failed to load:', error);
        showStatus('Some overlay images failed to load, but you can still convert PDF', 'info');
      });

      // Initialize
      resetUI();
      
      // Debug helper
      window.debugPDF = () => {
        console.log('PDF Document:', pdfDoc);
        console.log('Current Page:', currentPageNum);
        console.log('Total Pages:', totalPages);
        console.log('PDF File Name:', pdfFileName);
        console.log('Images Loaded:', imagesLoaded);
        console.log('Logo Image:', logoImage);
        console.log('Watermark Image:', watermarkImage);
        console.log('Notebook Image:', notebookImage);
      };
    });
  </script>
</body>
</html>
